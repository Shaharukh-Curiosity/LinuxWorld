'use strict';
<<<<<<< HEAD
const isPlainObj = require('is-plain-obj');

module.exports = (obj, opts) => {
=======
var isPlainObj = require('is-plain-obj');

module.exports = function (obj, opts) {
>>>>>>> dc7ca8caa9759d4a9def25682707f917f8e9a75e
	if (!isPlainObj(obj)) {
		throw new TypeError('Expected a plain object');
	}

	opts = opts || {};

	// DEPRECATED
	if (typeof opts === 'function') {
<<<<<<< HEAD
		throw new TypeError('Specify the compare function as an option instead');
	}

	const deep = opts.deep;
	const seenInput = [];
	const seenOutput = [];

	const sortKeys = x => {
		const seenIndex = seenInput.indexOf(x);
=======
		opts = {compare: opts};
	}

	var deep = opts.deep;
	var seenInput = [];
	var seenOutput = [];

	var sortKeys = function (x) {
		var seenIndex = seenInput.indexOf(x);
>>>>>>> dc7ca8caa9759d4a9def25682707f917f8e9a75e

		if (seenIndex !== -1) {
			return seenOutput[seenIndex];
		}

<<<<<<< HEAD
		const ret = {};
		const keys = Object.keys(x).sort(opts.compare);
=======
		var ret = {};
		var keys = Object.keys(x).sort(opts.compare);
>>>>>>> dc7ca8caa9759d4a9def25682707f917f8e9a75e

		seenInput.push(x);
		seenOutput.push(ret);

<<<<<<< HEAD
		for (let i = 0; i < keys.length; i++) {
			const key = keys[i];
			const val = x[key];

			if (deep && Array.isArray(val)) {
				const retArr = [];

				for (let j = 0; j < val.length; j++) {
					retArr[j] = isPlainObj(val[j]) ? sortKeys(val[j]) : val[j];
				}

				ret[key] = retArr;
				continue;
			}
=======
		for (var i = 0; i < keys.length; i++) {
			var key = keys[i];
			var val = x[key];
>>>>>>> dc7ca8caa9759d4a9def25682707f917f8e9a75e

			ret[key] = deep && isPlainObj(val) ? sortKeys(val) : val;
		}

		return ret;
	};

	return sortKeys(obj);
};
